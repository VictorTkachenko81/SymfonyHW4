{% extends 'AppBundle::base.html.twig' %}

{% block body %}

    <div class="page-header">
        <h1>Country List</h1>
    </div>

    <div id="formBlock">
        {#<p><a class="btn btn-default" href="{{ url('countryEdit', {'countryCode': 'new'}) }}" role="button" id="show_add_form">Add new country</a></p>#}
        <p><a class="btn btn-default" href="{{ url('countryNew') }}" role="button" id="show_add_form">Add new country</a></p>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-squad">
            <thead>
            <tr>
                <th>#</th>
                <th>Country</th>
                <th>Code</th>
                <th>Edit</th>
                <th>Remove</th>
            </tr>
            </thead>
            <tbody>
                {% for key, country in countries %}
                    <tr>
                        <td>{{ key + 1 }}</td>
                        <td>
                            <a href="{{ url('country', {'countryCode': country.code}) }}">
                                {{ country.name }}
                            </a>
                        </td>
                        <td>{{ country.code }}</td>
                        <td>
                            <a class="edit" href="{{ url('countryEdit', {'countryCode': country.code, 'action': 'edit'}) }}">
                                edit
                            </a>
                        </td>
                        <td>
                            <a class="remove" href="{{ url('countryEdit', {'countryCode': country.code, 'action': 'remove'}) }}">
                                remove
                            </a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>



{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $( document ).ready(function() {
            $( "a.edit" ).click(function(event) {
                event.preventDefault();
                    $.ajax({
                        url: $(this).attr('href'),
                        dataType: "html",
                        method: "GET",
                        statusCode: {
                            404: function() {
                                alert( "page not found" );
                            }
                        }
                    }).done(function( html ) {
                        $( "#formBlock" ).html( html );
                    });
            });

            $( "a.remove" ).click(function(event) {
                event.preventDefault();
                var r = confirm("Are you sure you want to do this?");
                if (r == true) {
//                    alert($(this).attr('href'));
                    window.location.href = $(this).attr('href');
                }
            });

            $( "#show_add_form" ).click(function(event) {
                event.preventDefault();
                $.ajax({
                    url: $(this).attr('href'),
                    dataType: "html",
                    method: "GET",
                    statusCode: {
                        404: function() {
                            alert( "page not found" );
                        }
                    }
                }).done(function( html ) {
                    $( "#formBlock" ).html( html ).slideDown("slow");
                });
            });

        });
    </script>
{% endblock %}